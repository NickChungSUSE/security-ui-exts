<template>
  <div class="page">
    <div class="header-section">
      <div class="title">
        {{ t("imageScanner.images.title") }}
      </div>
      <div class="filter-dropdown">
        <LabeledSelect
          v-model:value="selectedCveFilter"
          :options="filterCveOptions"
          :close-on-select="true"
          :multiple="false"
        />
      </div>
      <div class="filter-dropdown">
        <LabeledSelect
          v-model:value="selectedImageFilter"
          :options="filterImageOptions"
          :close-on-select="true"
          :multiple="false"
        />
      </div>
      <div>
        <button
          mat-button
          class="btn role-primary"
          aria-label="Download full report"
          type="button"
          :disabled="disabled"
          @click="openAddEditRuleModal()">
          {{ t('imageScanner.images.downloadReport') }}
        </button>
      </div>
    </div>
    <div class="summary-section">
      <TopRiskyImagesChart :topRiskyImages="topRiskyImages"/>
      <ImageRiskAssessment :chartData="chartData"/>
    </div>
    <div class="table-filter-section">
      <div class="table-filter">
        <label class="title">
          {{ t("imageScanner.images.filters.imageList.image") }}
        </label>
        <LabeledSelect
          v-model:value="selectedImage"
          :options="[]"
          :close-on-select="true"
          :multiple="false"
        />
      </div>
      <div class="table-filter">
        <label class="title">
          {{ t("imageScanner.images.filters.imageList.severity") }}
        </label>
        <LabeledSelect
          v-model:value="selectedSeverity"
          :options="[]"
          :close-on-select="true"
          :multiple="false"
        />
      </div>
      <div class="table-filter">
        <label class="title">
          {{ t("imageScanner.images.filters.imageList.repository") }}
        </label>
        <LabeledSelect
          v-model:value="selectedRepository"
          :options="[]"
          :close-on-select="true"
          :multiple="false"
        />
      </div>
      <div class="table-filter">
        <label class="title">
          {{ t("imageScanner.images.filters.imageList.registry") }}
        </label>
        <LabeledSelect
          v-model:value="selectedRegistry"
          :options="[]"
          :close-on-select="true"
          :multiple="false"
        />
      </div>
    </div>
    <div class="table-area">

    </div>
  </div>


</template>

<script>
  import LabeledSelect from "@shell/components/form/LabeledSelect";
  import TopRiskyImagesChart from "@sbombastic-image-vulnerability-scanner/components/TopRiskyImagesChart";
  import ImageRiskAssessment from "@sbombastic-image-vulnerability-scanner/components/ImageRiskAssessment"
  export default {
    name: 'imageOverview',
    components: {
      LabeledSelect,
      TopRiskyImagesChart,
      ImageRiskAssessment,
    },
    data() {
      const filterCveOptions = [
        this.t('imageScanner.images.filters.cve.allCves'),
        this.t('imageScanner.images.filters.cve.affectingCvesOnly'),
      ];
      const filterImageOptions = [
        this.t('imageScanner.images.filters.image.allImages'),
        this.t('imageScanner.images.filters.image.excludeBaseImages'),
        this.t('imageScanner.images.filters.image.includeBaseImages')
      ];
      return {
        topRiskyImages: [
          {
            image_name: "struts-attacher:1.0",
            cve_cnt: {
              critical: 128,
              high: 12,
              medium: 81,
              low: 256,
              none: 126,
            }
          },
          {
            image_name: "imagemagick4.8.5613",
            cve_cnt: {
              critical: 7,
              high: 0,
              medium: 1028,
              low: 24,
              none: 18,
            }
          },
          {
            image_name: "centos7.7.1908",
            cve_cnt: {
              critical: 72,
              high: 0,
              medium: 164,
              low: 0,
              none: 7,
            }
          },
          {
            image_name: "nginx1.19.10",
            cve_cnt: {
              critical: 150,
              high: 5,
              medium: 850,
              low: 600,
              none: 73,
            }
          },
          {
            image_name: "docker-compose:1.29.2",
            cve_cnt: {
              critical: 35,
              high: 2,
              medium: 450,
              low: 120,
              none: 9,
            }
          },
        ],
        chartData: {
          critical: 1627,
          high: 353,
          medium: 246,
          low: 1265,
          none: 293,
        },
        filterCveOptions,
        filterImageOptions,
        selectedCveFilter: filterCveOptions[0],
        selectedImageFilter: filterImageOptions[0],
        selectedImage: "",
        selectedSeverity: "Any",
        selectedRepository: "Any",
        selectedRegistry: "Any",
      }
    },

    async fetch() {
      
    },

    methods: {
      changeImageFilter() {},
      changeCveFilter() {}
    },

    computed: {
    },
  }

</script>


<style scoped>
  .page {
    display: flex;
    flex-direction: column;
    padding: 20px;
    min-height: 100%;
  }
  .header-section {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    align-self: stretch;
    border-radius: 6px;
    .title {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      gap: 4px;
      flex: 1 0 0;
      color: #141419;
      font-family: Lato;
      font-size: 24px;
      font-style: normal;
      font-weight: 600;
      line-height: 32px; /* 133.333% */
    }
    .filter-dropdown {
      display: flex;
      width: 225px;
      height: 40px;
    }
  }
  .summary-section {
    display: flex;
    align-items: flex-start;
    align-self: stretch;
    border-radius: 6px;
    border: 1px solid #DCDEE7;
    background: #FFF;
    margin: 24px 0;
  }
  .table-filter-section {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    align-self: stretch;
    .table-filter {
      justify-content: center;
      align-items: flex-start;
      gap: 4px;
      flex: 1 0 0;
      .title {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
        align-self: stretch;
        overflow: hidden;
        color: #6C6C76;
        text-overflow: ellipsis;
        font-family: Lato;
        font-size: 14px;
        font-style: normal;
        font-weight: 400;
        line-height: 21px; /* 150% */
      }
    }
  }

</style>