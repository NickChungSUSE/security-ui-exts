<template>
  <div class="page">
    <h2>{{ content }} ({{ rows.length }})</h2>
    <!-- <div v-for="row in rows">{{ row.id }} {{ row.spec.repositories }} {{ row.spec.uri }} {{ row.status.conditions[0].message }}</div> -->
    <ResourceTable
      :schema="schema"
      :rows="rows"
      :headers="headers"
      :use-query-params-for-simple-filtering="true"
    />
  </div>


</template>

<script>

  import { ref } from "vue";
  import { RESOURCE } from "@sbombastic-image-vulnerability-scanner/types";
  import ResourceTable from '@shell/components/ResourceTable';
  export default {
    name: 'registries',
    components: {
      ResourceTable
    },
    data() {
      return {
        content: ref("Registries"),
        headers: [
          {
            name:          'name',
            label:         'Name',
            value:         'id',
            sort:          ['nameSort'],
            canBeVariable: true,
          },
          {
            name:          'registries',
            label:         'Registries',
            value:         'spec.repositories',
            sort:          ['nameSort'],
            canBeVariable: true,
          },
          {
            name:          'uri',
            label:         'URI',
            value:         'spec.uri',
            sort:          ['nameSort'],
            canBeVariable: true,
          },
        ],
      }
    },

    async fetch() {
      await this.$store.dispatch('cluster/findAll', { type: RESOURCE.REGISTRY });
    },

    computed: {
      rows() {
        return this.$store.getters['cluster/all'](RESOURCE.REGISTRY);
      },
      schema() {
        return this.$store.getters['cluster/schemaFor'](RESOURCE.REGISTRY);
      }
    }
  }

</script>


<style scoped>
  .page {
    display: flex;
    flex-direction: column;
    padding: 20px;
    min-height: 100%;
  }

</style>